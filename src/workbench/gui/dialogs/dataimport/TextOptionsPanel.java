/*
 * TextOptionsPanel.java
 *
 * This file is part of SQL Workbench/J, http://www.sql-workbench.net
 *
 * Copyright 2002-2011, Thomas Kellerer
 * No part of this code may be reused without the permission of the author
 *
 * To contact the author please send an email to: support@sql-workbench.net
 *
 */
package workbench.gui.dialogs.dataimport;

import javax.swing.JPanel;
import workbench.gui.dialogs.QuoteSettingVerifier;
import workbench.resource.ResourceMgr;
import workbench.resource.Settings;
import workbench.util.QuoteEscapeType;
import workbench.util.StringUtil;

/**
 *
 * @author  Thomas Kellerer
 */
public class TextOptionsPanel
	extends JPanel
	implements TextImportOptions
{
	
	public TextOptionsPanel()
	{
		super();
		initComponents();
		// The verifier will register itself with the two checkboxes
		new QuoteSettingVerifier(quoteEscape, quoteAlways);
	}

	public void saveSettings()
	{
		saveSettings("text");
	}

	public void saveSettings(String key)
	{
		Settings s = Settings.getInstance();
		s.setProperty("workbench.import."  + key + ".containsheader", this.getContainsHeader());
		s.setProperty("workbench.import." + key + ".decode", this.getDecode());
		s.setDelimiter("workbench.import." + key + ".fielddelimiter", getTextDelimiter());
		s.setProperty("workbench.import." + key + ".quotechar", this.getTextQuoteChar());
		s.setProperty("workbench.import." + key + ".decimalchar", this.getDecimalChar());
		s.setProperty("workbench.import." + key + ".quote.escape", getQuoteEscaping().toString());
		s.setProperty("workbench.import." + key + ".quotealways", this.getQuoteAlways());
	}

	public void restoreSettings()
	{
		restoreSettings("text");
	}

	public void restoreSettings(String key)
	{
		Settings s = Settings.getInstance();
		this.setContainsHeader(s.getBoolProperty("workbench.import." + key + ".containsheader", true));
		this.setDecode(s.getBoolProperty("workbench.import." + key + ".decode", false));
		this.setTextQuoteChar(s.getProperty("workbench.import." + key + ".quotechar", s.getQuoteChar()));
		this.quoteAlways.setSelected(s.getBoolProperty("workbench.import." + key + ".quotealways", false));
		this.setTextDelimiter(s.getDelimiter("workbench.import." + key + ".fielddelimiter", "\\t", true));
		this.setDecimalChar(s.getProperty("workbench.import." + key + ".decimalchar", "."));
		String quote = s.getProperty("workbench.import." + key + ".quote.escape", "none");
		QuoteEscapeType escape = null;
		try
		{
			escape = QuoteEscapeType.valueOf(quote);
		}
		catch (Exception e)
		{
			escape = QuoteEscapeType.none;
		}
		quoteEscape.setEscapeType(escape);
	}

	@Override
	public boolean getQuoteAlways()
	{
		return this.quoteAlways.isSelected();
	}
	
	@Override
	public QuoteEscapeType getQuoteEscaping()
	{
		return quoteEscape.getEscapeType();
	}

	public boolean getDecode()
	{
		return this.decode.isSelected();
	}

	public void setDecode(boolean flag)
	{
		this.decode.setSelected(flag);
	}

	public boolean getContainsHeader()
	{
		return this.headerIncluded.isSelected();
	}

	public String getTextDelimiter()
	{
		return this.delimiter.getText();
	}

	public String getTextQuoteChar()
	{
		return this.quoteChar.getText();
	}

	public void disableHeaderSelection()
	{
		this.headerIncluded.setEnabled(false);
	}
	public void setContainsHeader(boolean flag)
	{
		this.headerIncluded.setSelected(flag);
	}

	public void setTextDelimiter(String delim)
	{
		this.delimiter.setText(delim);
	}

	public void setTextQuoteChar(String quote)
	{
		this.quoteChar.setText(quote);
	}

	public String getDecimalChar()
	{
		String s = this.decimalCharTextField.getText();
		if (StringUtil.isBlank(s)) return ".";
		return s.trim();
	}

	public void setDecimalChar(String s)
	{
		this.decimalCharTextField.setText(s);
	}

	/** This method is called from within the constructor to
	 * initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is
	 * always regenerated by the Form Editor.
	 */
  // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
  private void initComponents() {
    java.awt.GridBagConstraints gridBagConstraints;

    delimiterLabel = new javax.swing.JLabel();
    delimiter = new javax.swing.JTextField();
    headerIncluded = new javax.swing.JCheckBox();
    quoteCharLabel = new javax.swing.JLabel();
    quoteChar = new javax.swing.JTextField();
    jPanel1 = new javax.swing.JPanel();
    decode = new javax.swing.JCheckBox();
    decimalCharLabel = new javax.swing.JLabel();
    decimalCharTextField = new javax.swing.JTextField();
    quoteEscape = new workbench.gui.dialogs.QuoteEscapeSelector();
    quoteAlways = new javax.swing.JCheckBox();

    setLayout(new java.awt.GridBagLayout());

    delimiterLabel.setText(ResourceMgr.getString("LblFieldDelimiter")); // NOI18N
    delimiterLabel.setToolTipText(ResourceMgr.getString("d_LblFieldDelimiter")); // NOI18N
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 4;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
    gridBagConstraints.insets = new java.awt.Insets(6, 4, 0, 4);
    add(delimiterLabel, gridBagConstraints);
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 1;
    gridBagConstraints.gridy = 4;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
    gridBagConstraints.weightx = 1.0;
    gridBagConstraints.insets = new java.awt.Insets(5, 4, 0, 4);
    add(delimiter, gridBagConstraints);

    headerIncluded.setText(ResourceMgr.getString("LblImportIncludeHeaders")); // NOI18N
    headerIncluded.setToolTipText(ResourceMgr.getString("d_LblImportIncludeHeaders")); // NOI18N
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 1;
    gridBagConstraints.gridwidth = 2;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
    add(headerIncluded, gridBagConstraints);

    quoteCharLabel.setText(ResourceMgr.getString("LblQuoteChar")); // NOI18N
    quoteCharLabel.setToolTipText(ResourceMgr.getString("d_LblQuoteChar")); // NOI18N
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 5;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
    gridBagConstraints.insets = new java.awt.Insets(6, 4, 0, 4);
    add(quoteCharLabel, gridBagConstraints);
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 1;
    gridBagConstraints.gridy = 5;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
    gridBagConstraints.insets = new java.awt.Insets(5, 4, 0, 4);
    add(quoteChar, gridBagConstraints);
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 1;
    gridBagConstraints.gridy = 9;
    gridBagConstraints.weighty = 1.0;
    add(jPanel1, gridBagConstraints);

    decode.setText(ResourceMgr.getString("LblImportDecode")); // NOI18N
    decode.setToolTipText(ResourceMgr.getString("d_LblImportDecode")); // NOI18N
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridwidth = 2;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
    add(decode, gridBagConstraints);

    decimalCharLabel.setText(ResourceMgr.getString("LblImportDecimalChar")); // NOI18N
    decimalCharLabel.setToolTipText(ResourceMgr.getString("d_LblImportDecimalChar")); // NOI18N
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 2;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
    gridBagConstraints.insets = new java.awt.Insets(3, 4, 0, 4);
    add(decimalCharLabel, gridBagConstraints);

    decimalCharTextField.setToolTipText(ResourceMgr.getDescription("LblImportDecimalChar"));
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 1;
    gridBagConstraints.gridy = 2;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
    gridBagConstraints.insets = new java.awt.Insets(0, 4, 0, 4);
    add(decimalCharTextField, gridBagConstraints);
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 7;
    gridBagConstraints.gridwidth = 2;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
    gridBagConstraints.insets = new java.awt.Insets(5, 4, 0, 4);
    add(quoteEscape, gridBagConstraints);

    quoteAlways.setText(ResourceMgr.getString("LblExportQuoteAlways")); // NOI18N
    quoteAlways.setBorder(null);
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 8;
    gridBagConstraints.gridwidth = 2;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
    gridBagConstraints.insets = new java.awt.Insets(9, 4, 0, 0);
    add(quoteAlways, gridBagConstraints);
  }// </editor-fold>//GEN-END:initComponents


  // Variables declaration - do not modify//GEN-BEGIN:variables
  private javax.swing.JLabel decimalCharLabel;
  private javax.swing.JTextField decimalCharTextField;
  private javax.swing.JCheckBox decode;
  private javax.swing.JTextField delimiter;
  private javax.swing.JLabel delimiterLabel;
  private javax.swing.JCheckBox headerIncluded;
  private javax.swing.JPanel jPanel1;
  private javax.swing.JCheckBox quoteAlways;
  private javax.swing.JTextField quoteChar;
  private javax.swing.JLabel quoteCharLabel;
  private workbench.gui.dialogs.QuoteEscapeSelector quoteEscape;
  // End of variables declaration//GEN-END:variables

}
