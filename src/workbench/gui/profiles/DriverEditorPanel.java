/*
 * DriverEditorPanel.java
 *
 * This file is part of SQL Workbench/J, http://www.sql-workbench.net
 *
 * Copyright 2002-2007, Thomas Kellerer
 * No part of this code maybe reused without the permission of the author
 *
 * To contact the author please send an email to: support@sql-workbench.net
 *
 */
package workbench.gui.profiles;

import java.io.File;

import javax.swing.JFileChooser;
import javax.swing.SwingUtilities;

import workbench.db.DbDriver;
import workbench.gui.components.ExtensionFileFilter;
import workbench.gui.components.TextComponentMouseListener;
import workbench.resource.ResourceMgr;
import workbench.resource.Settings;
import workbench.util.StringUtil;

/**
 *
 * @author  support@sql-workbench.net
 */
public class DriverEditorPanel
	extends javax.swing.JPanel
{
	private DbDriver currentDriver;

	/** Creates new form BeanForm */
	public DriverEditorPanel()
	{
		initComponents();
		String text = ResourceMgr.getDescription("LblDriverLibrary");
		text = text.replaceAll("%path_sep%", StringUtil.PATH_SEPARATOR);
		lblLibrary.setToolTipText(text);
		tfLibrary.setToolTipText(text);
    text = ResourceMgr.getDescription("SelectDriverLibrary");
    jButton1.setToolTipText(text);
	}

	/** This method is called from within the constructor to
	 * initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is
	 * always regenerated by the Form Editor.
	 */
	private void initComponents()//GEN-BEGIN:initComponents
	{
		java.awt.GridBagConstraints gridBagConstraints;
		
		lblName = new javax.swing.JLabel();
		tfName = new javax.swing.JTextField();
		lblClassName = new javax.swing.JLabel();
		tfClassName = new javax.swing.JTextField();
		lblLibrary = new javax.swing.JLabel();
		tfLibrary = new javax.swing.JTextField();
		jPanel1 = new javax.swing.JPanel();
		jButton1 = new javax.swing.JButton();
		lblSample = new javax.swing.JLabel();
		tfSampleUrl = new javax.swing.JTextField();
		
		setLayout(new java.awt.GridBagLayout());
		
		setFont(null);
		lblName.setFont(null);
		lblName.setText(ResourceMgr.getString("LblDriverName"));
		gridBagConstraints = new java.awt.GridBagConstraints();
		gridBagConstraints.gridx = 0;
		gridBagConstraints.gridy = 0;
		gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
		gridBagConstraints.insets = new java.awt.Insets(11, 10, 0, 7);
		add(lblName, gridBagConstraints);
		
		tfName.setHorizontalAlignment(javax.swing.JTextField.LEFT);
		tfName.setMinimumSize(new java.awt.Dimension(50, 20));
		tfName.setPreferredSize(new java.awt.Dimension(100, 20));
		tfName.addMouseListener(new TextComponentMouseListener());
		tfName.addFocusListener(new java.awt.event.FocusAdapter()
		{
			public void focusLost(java.awt.event.FocusEvent evt)
			{
				DriverEditorPanel.this.focusLost(evt);
			}
		});
		
		gridBagConstraints = new java.awt.GridBagConstraints();
		gridBagConstraints.gridx = 1;
		gridBagConstraints.gridy = 0;
		gridBagConstraints.gridwidth = java.awt.GridBagConstraints.REMAINDER;
		gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
		gridBagConstraints.anchor = java.awt.GridBagConstraints.EAST;
		gridBagConstraints.weightx = 1.0;
		gridBagConstraints.insets = new java.awt.Insets(11, 3, 0, 3);
		add(tfName, gridBagConstraints);
		
		lblClassName.setFont(null);
		lblClassName.setText(ResourceMgr.getString("LblDriverClass"));
		gridBagConstraints = new java.awt.GridBagConstraints();
		gridBagConstraints.gridx = 0;
		gridBagConstraints.gridy = 1;
		gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
		gridBagConstraints.insets = new java.awt.Insets(0, 10, 0, 7);
		add(lblClassName, gridBagConstraints);
		
		tfClassName.setColumns(10);
		tfClassName.setHorizontalAlignment(javax.swing.JTextField.LEFT);
		tfClassName.addMouseListener(new TextComponentMouseListener());
		tfClassName.addFocusListener(new java.awt.event.FocusAdapter()
		{
			public void focusLost(java.awt.event.FocusEvent evt)
			{
				DriverEditorPanel.this.focusLost(evt);
			}
		});
		
		gridBagConstraints = new java.awt.GridBagConstraints();
		gridBagConstraints.gridx = 1;
		gridBagConstraints.gridy = 1;
		gridBagConstraints.gridwidth = java.awt.GridBagConstraints.REMAINDER;
		gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
		gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
		gridBagConstraints.insets = new java.awt.Insets(0, 3, 0, 3);
		add(tfClassName, gridBagConstraints);
		
		lblLibrary.setFont(null);
		lblLibrary.setText(ResourceMgr.getString("LblDriverLibrary"));
		gridBagConstraints = new java.awt.GridBagConstraints();
		gridBagConstraints.gridx = 0;
		gridBagConstraints.gridy = 2;
		gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
		gridBagConstraints.insets = new java.awt.Insets(0, 10, 0, 7);
		add(lblLibrary, gridBagConstraints);
		
		tfLibrary.setColumns(10);
		tfLibrary.setHorizontalAlignment(javax.swing.JTextField.LEFT);
		tfLibrary.addMouseListener(new TextComponentMouseListener());
		tfLibrary.addFocusListener(new java.awt.event.FocusAdapter()
		{
			public void focusLost(java.awt.event.FocusEvent evt)
			{
				DriverEditorPanel.this.focusLost(evt);
			}
		});
		
		gridBagConstraints = new java.awt.GridBagConstraints();
		gridBagConstraints.gridx = 1;
		gridBagConstraints.gridy = 2;
		gridBagConstraints.gridwidth = 4;
		gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
		gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
		gridBagConstraints.weightx = 1.0;
		gridBagConstraints.insets = new java.awt.Insets(0, 3, 0, 3);
		add(tfLibrary, gridBagConstraints);
		
		gridBagConstraints = new java.awt.GridBagConstraints();
		gridBagConstraints.gridx = 0;
		gridBagConstraints.gridy = 4;
		gridBagConstraints.gridheight = java.awt.GridBagConstraints.REMAINDER;
		gridBagConstraints.anchor = java.awt.GridBagConstraints.SOUTH;
		gridBagConstraints.weighty = 1.0;
		add(jPanel1, gridBagConstraints);
		
		jButton1.setFont(null);
		jButton1.setText("...");
		jButton1.setMaximumSize(new java.awt.Dimension(20, 20));
		jButton1.setMinimumSize(new java.awt.Dimension(20, 20));
		jButton1.setPreferredSize(new java.awt.Dimension(20, 20));
		jButton1.addActionListener(new java.awt.event.ActionListener()
		{
			public void actionPerformed(java.awt.event.ActionEvent evt)
			{
				selectLibrary(evt);
			}
		});
		
		gridBagConstraints = new java.awt.GridBagConstraints();
		gridBagConstraints.gridx = 5;
		gridBagConstraints.gridy = 2;
		gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 3);
		add(jButton1, gridBagConstraints);
		
		lblSample.setFont(null);
		lblSample.setText(ResourceMgr.getString("LblSampleUrl"));
		gridBagConstraints = new java.awt.GridBagConstraints();
		gridBagConstraints.gridx = 0;
		gridBagConstraints.gridy = 3;
		gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
		gridBagConstraints.insets = new java.awt.Insets(0, 10, 0, 7);
		add(lblSample, gridBagConstraints);
		
		tfSampleUrl.setColumns(10);
		tfSampleUrl.setFont(null);
		tfSampleUrl.setHorizontalAlignment(javax.swing.JTextField.LEFT);
		tfSampleUrl.addMouseListener(new TextComponentMouseListener());
		gridBagConstraints = new java.awt.GridBagConstraints();
		gridBagConstraints.gridx = 1;
		gridBagConstraints.gridy = 3;
		gridBagConstraints.gridwidth = java.awt.GridBagConstraints.REMAINDER;
		gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
		gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
		gridBagConstraints.insets = new java.awt.Insets(0, 3, 0, 3);
		add(tfSampleUrl, gridBagConstraints);
		
	}//GEN-END:initComponents

	private void focusLost(java.awt.event.FocusEvent evt)//GEN-FIRST:event_focusLost
	{//GEN-HEADEREND:event_focusLost
		this.updateDriver();
	}//GEN-LAST:event_focusLost

	private void selectLibrary(java.awt.event.ActionEvent evt)//GEN-FIRST:event_selectLibrary
	{//GEN-HEADEREND:event_selectLibrary
		String lastDir = Settings.getInstance().getLastLibraryDir();
		JFileChooser jf = new JFileChooser(lastDir);
		jf.setMultiSelectionEnabled(true);
		jf.setFileFilter(ExtensionFileFilter.getJarFileFilter());
		int answer = jf.showOpenDialog(SwingUtilities.getWindowAncestor(this));
		if (answer == JFileChooser.APPROVE_OPTION)
		{
			File[] f = jf.getSelectedFiles();
			StringBuilder path = new StringBuilder(f.length * 100);
			for (int i=0; i < f.length; i++)
			{
				if (i>0) path.append(StringUtil.PATH_SEPARATOR);
				path.append(f[i].getAbsolutePath().trim());
			}
			this.tfLibrary.setText(path.toString());
			this.updateDriver();
			Settings.getInstance().setLastLibraryDir(jf.getCurrentDirectory().getAbsolutePath());
		}
	}//GEN-LAST:event_selectLibrary

	public void setDriver(DbDriver aDriver)
	{
		this.currentDriver = aDriver;
		this.tfName.setText(aDriver.getName());
		this.tfClassName.setText(aDriver.getDriverClass());
		this.tfLibrary.setText(aDriver.getLibrary());
		this.tfSampleUrl.setText(aDriver.getSampleUrl());
	}

	void updateDriver()
	{
		this.currentDriver.setName(tfName.getText());
		this.currentDriver.setDriverClass(tfClassName.getText());
		this.currentDriver.setLibrary(tfLibrary.getText());
		this.currentDriver.setSampleUrl(tfSampleUrl.getText());
	}

	public DbDriver getDriver()
	{
		this.updateDriver();
		return this.currentDriver;
	}

	public void reset()
	{
		this.currentDriver = null;
		this.tfName.setText("");
		this.tfClassName.setText("");
		this.tfLibrary.setText("");
		this.tfSampleUrl.setText("");
	}
	
	// Variables declaration - do not modify//GEN-BEGIN:variables
	private javax.swing.JButton jButton1;
	private javax.swing.JPanel jPanel1;
	private javax.swing.JLabel lblClassName;
	private javax.swing.JLabel lblLibrary;
	private javax.swing.JLabel lblName;
	private javax.swing.JLabel lblSample;
	private javax.swing.JTextField tfClassName;
	private javax.swing.JTextField tfLibrary;
	private javax.swing.JTextField tfName;
	private javax.swing.JTextField tfSampleUrl;
	// End of variables declaration//GEN-END:variables


}
